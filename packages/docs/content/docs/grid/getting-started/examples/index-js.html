---
---

<script type="module">
  import { DataDen, DataDenDefaultCellRenderer } from '/js/data-den.es.min.js';
  const rows = [
    { car: 'Honda', model: 'Civic', year: '01/05/2013', price: 28000 },
    { car: 'Mitsubishi', model: 'Lancer', year: '01/05/2013', price: 56000 },
    { car: 'Porsche', model: 'Boxster', year: '09/02/2020', price: 31000 },
    { car: 'Toyota', model: 'Celica', year: '16/12/2010', price: 18000 },
    { car: 'Kia', model: 'Sportage', year: '14/09/2006', price: 28000 },
    { car: 'Ford', model: 'Focus', year: '04/07/2014', price: 24000 },
    { car: 'Ford', model: 'Focus', year: '16/12/2010', price: 24000 },
    { car: 'Porsche', model: 'Boxster', year: '24/01/2015', price: 31000 },
    { car: 'Mitsubishi', model: 'Lancer', year: '14/09/2006', price: 18000 },
    { car: 'Kia', model: 'Sportage', year: '01/05/2013', price: 24000 },
  ];

  const options = {
    columns: [
      {
        field: 'car',
        headerName: 'Car',
        cellRenderer: DataDenDefaultCellRenderer,
      },
      {
        field: 'model',
        headerName: 'Model',
        cellRenderer: DataDenDefaultCellRenderer,
      },
      {
        field: 'year',
        headerName: 'Year',
        cellRenderer: DataDenDefaultCellRenderer,
      },
      {
        field: 'price',
        headerName: 'Price',
        cellRenderer: DataDenDefaultCellRenderer,
      },
    ],
    rows: rows,
  };

  (() => {
    //basic example
    const ddElBasic = document.getElementById('dd-basic');
    const dataDenBasic = new DataDen(ddElBasic, options);
    //basic example

    //search example
    const ddElSearch = document.getElementById('dd-search');
    const dataDenSearch = new DataDen(ddElSearch, { ...options, quickFilter: true });
    const searchInput = document.querySelector('.data-den-quick-filter-input');
    searchInput.addEventListener('keyup', () => {
      dataDenSearch.quickFilter(searchInput.value);
    });
    //search example

    //draggable example
    const ddElDraggable = document.getElementById('dd-draggable');
    const dataDenDraggable = new DataDen(ddElDraggable, { ...options, draggable: true });
    //draggable example
  })();

  //pagination example
  (() => {
    const rows = [
      { car: 'Honda', model: 'Civic', year: '01/05/2013', price: 28000 },
      { car: 'Mitsubishi', model: 'Lancer', year: '01/05/2013', price: 56000 },
      { car: 'Porsche', model: 'Boxster', year: '09/02/2020', price: 31000 },
      { car: 'Toyota', model: 'Celica', year: '16/12/2010', price: 18000 },
      { car: 'Kia', model: 'Sportage', year: '14/09/2006', price: 28000 },
      { car: 'Ford', model: 'Focus', year: '04/07/2014', price: 24000 },
      { car: 'Ford', model: 'Focus', year: '16/12/2010', price: 24000 },
      { car: 'Porsche', model: 'Boxster', year: '24/01/2015', price: 31000 },
      { car: 'Mitsubishi', model: 'Lancer', year: '14/09/2006', price: 18000 },
      { car: 'Kia', model: 'Sportage', year: '01/05/2013', price: 24000 },
      { car: 'Porsche', model: 'Boxster', year: '28/08/2004', price: 28000 },
      { car: 'Toyota', model: 'Celica', year: '28/08/2004', price: 12000 },
      { car: 'Mitsubishi', model: 'Lancer', year: '16/12/2010', price: 32000 },
      { car: 'Toyota', model: 'Celica', year: '28/08/2004', price: 18000 },
      { car: 'Lamborghini', model: 'Aventador', year: '24/01/2015', price: 56000 },
      { car: 'Nissan', model: 'X-Trail', year: '01/05/2013', price: 56000 },
      { car: 'Honda', model: 'Civic', year: '01/05/2013', price: 15000 },
      { car: 'Porsche', model: 'Boxster', year: '24/01/2015', price: 24000 },
      { car: 'Ford', model: 'Focus', year: '14/09/2006', price: 15000 },
      { car: 'Lamborghini', model: 'Aventador', year: '14/09/2006', price: 15000 },
      { car: 'Ford', model: 'Focus', year: '09/02/2020', price: 12000 },
      { car: 'Honda', model: 'Civic', year: '24/01/2015', price: 32000 },
      { car: 'Mitsubishi', model: 'Lancer', year: '09/02/2020', price: 32000 },
      { car: 'Honda', model: 'Civic', year: '09/02/2020', price: 12000 },
      { car: 'Mitsubishi', model: 'Lancer', year: '09/02/2020', price: 15000 },
      { car: 'Ford', model: 'Focus', year: '28/08/2004', price: 24000 },
      { car: 'Nissan', model: 'X-Trail', year: '16/12/2010', price: 15000 },
      { car: 'Toyota', model: 'Celica', year: '13/11/2021', price: 15000 },
      { car: 'Toyota', model: 'Celica', year: '09/02/2020', price: 12000 },
      { car: 'Mitsubishi', model: 'Lancer', year: '09/02/2020', price: 32000 },
    ];

    const options = {
      columns: [
        {
          field: 'car',
          headerName: 'Car',
          cellRenderer: DataDenDefaultCellRenderer,
        },
        {
          field: 'model',
          headerName: 'Model',
          cellRenderer: DataDenDefaultCellRenderer,
        },
        {
          field: 'year',
          headerName: 'Year',
          cellRenderer: DataDenDefaultCellRenderer,
        },
        {
          field: 'price',
          headerName: 'Price',
          cellRenderer: DataDenDefaultCellRenderer,
        },
      ],
      rows: rows,
      pagination: true,
    };

    const ddEl = document.getElementById('dd-pagination');
    const dataDenBasic = new DataDen(ddEl, options);
  })();
  //pagination example

  //advanced structure
  (() => {
    const sortComparator = (fieldA, fieldB) => {
      if (typeof fieldA === 'string') {
        fieldA = fieldA.toLowerCase();
      }

      if (typeof fieldB === 'string') {
        fieldB = fieldB.toLowerCase();
      }

      if (fieldA === fieldB) {
        return 0;
      }

      return fieldA > fieldB ? 1 : -1;
    };

    const options = {
      columns: [
        {
          field: 'car',
          headerName: 'Car',
          sort: true,
          sortOptions: {
            comparator: sortComparator,
          },
          resize: true,
          width: 150,
          cellRenderer: DataDenDefaultCellRenderer,
        },
        {
          field: 'model',
          headerName: 'Model',
          sort: true,
          sortOptions: {
            comparator: sortComparator,
          },
          resize: true,
          width: 150,
          cellRenderer: DataDenDefaultCellRenderer,
        },
        {
          field: 'year',
          headerName: 'Year',
          sort: true,
          sortOptions: {
            comparator: sortComparator,
          },
          resize: true,
          width: 150,
          cellRenderer: DataDenDefaultCellRenderer,
        },
        {
          field: 'price',
          headerName: 'Price',
          sort: true,
          sortOptions: {
            comparator: sortComparator,
          },
          resize: true,
          width: 150,
          cellRenderer: DataDenDefaultCellRenderer,
        },
      ],
      rows: rows,
    };

    const ddElBasic = document.getElementById('dd-advanced-structure');
    const dataDenBasic = new DataDen(ddElBasic, options);
  })();
  //advanced structure

  //cell-formatting
  (() => {
    class ExampleCellRenderer {
      constructor(data) {
        this.value = data.value;
      }
      getGui() {
        const el = document.createElement('span');
        el.innerText = this.value;
        const wrapper = document.createElement('div');
        if (+this.value > 25000 && +this.value < 50000) {
          wrapper.classList.add('bg-warning');
        } else if (+this.value > 50000) {
          wrapper.classList.add('bg-danger');
        } else {
          wrapper.classList.add('bg-success');
        }

        wrapper.appendChild(el);

        return wrapper;
      }
    }

    const options = {
      columns: [
        {
          field: 'car',
          headerName: 'Car',
          cellRenderer: DataDenDefaultCellRenderer,
        },
        {
          field: 'model',
          headerName: 'Model',
          cellRenderer: DataDenDefaultCellRenderer,
        },
        {
          field: 'year',
          headerName: 'Year',
          cellRenderer: DataDenDefaultCellRenderer,
        },
        {
          field: 'price',
          headerName: 'Price',
          cellRenderer: ExampleCellRenderer,
        },
      ],
      rows: rows,
    };

    const ddElBasic = document.getElementById('dd-cell-formatting');
    const dataDenBasic = new DataDen(ddElBasic, options);
  })();
  //cell-formatting

  //search column example
  (() => {
    class DataDenHeaderTextFilterRenderer {
      constructor(params) {
        this.params = params;
        this.cssPrefix = params.cssPrefix;
        const template = `
      <div class="${this.cssPrefix}header-filter">
        <input type="text" class="${this.cssPrefix}header-filter-input" />
      </div>
    `;

        this.element = this.createHtmlElement(template);
        this.input = this.element.querySelector(`.${this.cssPrefix}header-filter-input`);

        this.attachUiEvents(params);
      }

      createHtmlElement(template, elementName = 'div') {
        const placeholder = document.createElement(elementName);
        placeholder.innerHTML = template;

        return placeholder.firstElementChild;
      }

      debounce(callback, debounceTime) {
        let timeout;

        return function (...args) {
          const debounceFn = () => {
            clearTimeout(timeout);
            callback(...args);
          };

          clearTimeout(timeout);
          timeout = setTimeout(debounceFn, debounceTime);
        };
      }

      getGui() {
        return this.element;
      }

      getType() {
        return 'text';
      }

      getState() {
        const value = this.input ? this.input.value : null;

        return {
          method: this.params.method,
          searchTerm: value,
        };
      }

      isActive() {
        const value = this.input ? this.input.value : null;

        return !!value;
      }

      getFilterFn() {
        const options = this.params.colDef.filterOptions;

        return (state, value) => {
          let searchTerm = state.searchTerm;
          const method = state.method;
          const caseSensitive = options.caseSensitive;
          value = caseSensitive ? value : value.toString().toLowerCase();
          searchTerm = caseSensitive ? searchTerm : searchTerm.toString().toLowerCase();

          switch (method) {
            case 'includes':
              return value.includes(searchTerm);
            default:
              return false;
          }
        };
      }

      attachUiEvents(params) {
        if (this.input) {
          const debounceFilter = this.debounce(() => params.filterChanged(), params.debounceTime);

          this.input.addEventListener('keyup', () => debounceFilter());
        }
      }

      destroy() {}
    }

    const options = {
      columns: [
        {
          field: 'car',
          headerName: 'Car',
          filter: true,
          filterRenderer: DataDenHeaderTextFilterRenderer,
          filterOptions: {
            method: 'includes',
            debounceTime: 500,
            caseSensitive: false,
          },
          cellRenderer: DataDenDefaultCellRenderer,
          width: 180,
        },
        {
          field: 'model',
          headerName: 'Model',
          filter: true,
          filterRenderer: DataDenHeaderTextFilterRenderer,
          filterOptions: {
            method: 'includes',
            debounceTime: 500,
            caseSensitive: false,
          },
          cellRenderer: DataDenDefaultCellRenderer,
          width: 180,
        },
        {
          field: 'year',
          headerName: 'Year',
          filter: true,
          filterRenderer: DataDenHeaderTextFilterRenderer,
          filterOptions: {
            method: 'includes',
            debounceTime: 500,
            caseSensitive: false,
          },
          cellRenderer: DataDenDefaultCellRenderer,
          width: 180,
        },
        {
          field: 'price',
          headerName: 'Price',
          filter: true,
          filterRenderer: DataDenHeaderTextFilterRenderer,
          filterOptions: {
            method: 'includes',
            debounceTime: 500,
            caseSensitive: false,
          },
          cellRenderer: DataDenDefaultCellRenderer,
          width: 180,
        },
      ],
      rows: rows,
    };

    const ddElSearchColumn = document.getElementById('dd-search-column');
    const dataDenSearchColumn = new DataDen(ddElSearchColumn, options);
  })();
  //search column example
</script>
